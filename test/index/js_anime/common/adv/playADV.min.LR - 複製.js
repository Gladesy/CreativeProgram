!function($){function loadCommonImages(){if($("#message").css("background-image","url("+commonDir+"message_window.png?anime="+cacheVersion+")"),$("#repeatButton").css("background-image","url("+commonDir+"button_repeat.png?anime="+cacheVersion+")"),$("#skipButton").css("background-image","url("+commonDir+"button_skip.png?anime="+cacheVersion+")"),$("#autoButton").css("background-image","url("+commonDir+"button_auto.png?anime="+cacheVersion+")"),$("#effectAutoButton").css("background-image","url("+commonDir+"button_auto_on.png?anime="+cacheVersion+")"),$("#xButton").css("background-image","url("+commonDir+"x.png?anime="+cacheVersion+")"),$("#ready").css({"background-image":"url("+commonDir+"voice_confirm.png?anime="+cacheVersion+")","background-repeat":"no-repeat"}),$("#btnSoundOn").css("background-image","url("+commonDir+"button_reproduce.png?anime="+cacheVersion+")"),$("#btnSoundOff").css("background-image","url("+commonDir+"button_notReproduce.png?anime="+cacheVersion+")"),!androidSm&&!iPhone){var e=commonDir+"button_reproduce.png?anime="+cacheVersion,a=commonDir+"button_notReproduce.png?anime="+cacheVersion,t='<style type="text/css">#btnSoundOn:before{display: block; content: "  "; color: rgba(0,0,0,0) !important; width: 276px; height: 56px; background-image: url('+e+"); background-size: 276px; transition: opacity 0.5s ease;}</style>",n='<style type="text/css">#btnSoundOn:hover:before{opacity: 0;}</style>',i='<style type="text/css">#btnSoundOff:before{display: block; content: "  "; color: rgba(0,0,0,0) !important; width: 276px; height: 56px; background-image: url('+a+"); background-size: 276px; transition: opacity 0.5s ease;}</style>",o='<style type="text/css">#btnSoundOff:hover:before{opacity: 0;}</style>';$("head").append(t),$("head").append(n),$("head").append(i),$("head").append(o)}$("#loader").css("display","none")}function initialize(){if(g_expand?addCanvasRotate():IE&&$("body").css({overflow:"hidden"}),androidSm||iPhone){var e=document.getElementsByTagName("body").item(0),a=document.createElement("div");a.id="scrollTarget",e.insertBefore(a,e.firstChild),a.scrollIntoView()}$("#message").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}),$("#charaName").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}),hitArea=document.getElementById("hitArea"),imageWidth=animeWidth,imageHeight=animeHeight,void 0!=advData.anime&&loadAnime(),void 0!=advData.illust&&loadIllust(),void 0!=advData.bg&&loadBG(),void 0!=advData.charaImage&&loadCharaImage(),isSkipEnable()||$("#skipButton").css({display:"none"}),androidSm||iPhone?0==di&&(isTutorial?onClickSoundSetButton(so>0?"on":"off"):onAutoStartSoundOff()):0==di&&onClickSoundSetButton(so>0?"on":"off")}function initCharaPosition(){objCharaPosition.Center.originX=Number($("#charaCenter").css("margin-left").replace("px","")),objCharaPosition.Center.originY=Number($("#charaCenter").css("margin-top").replace("px","")),objCharaPosition.Left.originX=Number($("#charaLeft").css("margin-left").replace("px","")),objCharaPosition.Left.originY=Number($("#charaLeft").css("margin-top").replace("px","")),objCharaPosition.Right.originX=Number($("#charaRight").css("margin-left").replace("px","")),objCharaPosition.Right.originY=Number($("#charaRight").css("margin-top").replace("px",""))}function loadAnime(){animeNum=loadImage("anime")}function loadIllust(){illustNum=loadImage("illust")}function loadCharaImage(){charaImageNum=loadImage("charaImage")}function loadBG(){bgNum=loadImage("bg")}function loadImage(e){var a=0,t=advData[e];if(Object.keys(t).length>0)for(var n in t){var i=IMG_ROOT+t[n].img+"?anime="+cacheVersion;getImageData(n,i),a++}return a}function getImageData(e,a){var t=new Image;androidSm&&e.match(/anime/)&&(a=a.replace("scene","scene_sp")),t.src=a,t.onload=function(){if(e.match(/anime/)){if(imageWidth=t.width,imageHeight=t.height,"undefined"!=typeof t.naturalWidth)imageWidth=t.naturalWidth,imageHeight=t.naturalHeight;else if("undefined"!=typeof t.runtimeStyle){var a=t.runtimeStyle,n={w:a.width,h:a.height};a.width="auto",a.height="auto",imageWidth=t.width,imageHeight=t.height,a.width=n.w,a.height=n.h}else{var n={w:t.width,h:t.height};t.removeAttribute("width"),t.removeAttribute("height"),imageWidth=t.width,imageHeight=t.height,t.width=n.w,t.height=n.h}var i=0;if(androidSm){var o=animeWidth/imageWidth;i=Math.round(imageHeight*o/animeHeight)}else i=Math.floor(imageHeight/animeHeight);objFrame[e]=i}else e.match(/charaImage/)?objCharaImage[e]=t:e.match(/illust/)?objIllust[e]=t:e.match(/bg/)&&(objBG[e]=t);checkLoadComp()}}function checkLoadComp(){var e=!0,a=0;for(var t in objFrame)objFrame[t]&&a++;a!==animeNum&&(e=!1),a=0;for(var n in objIllust)objIllust[n]&&a++;a!==illustNum&&(e=!1),a=0;for(var i in objCharaImage)objCharaImage[i]&&a++;a!==charaImageNum&&(e=!1),a=0;for(var o in objBG)objBG[o]&&a++;a!==bgNum&&(e=!1),e&&(loadCommonImages(),$("body").on(EVENT_TOUCH,onClickHandler))}function changeImage(e){var a,t=advData.scenario[scenarioIndex];if(stopAnimeMotion(),$("#anime").hasClass("canvasRotation")&&removeCanvasRotate(),e.match(/anime/)){if($("#bg").css({"background-image":"none"}),$("#charaCenter").css({"background-image":"none"}),$("#charaLeft").css({"background-image":"none"}),$("#charaRight").css({"background-image":"none"}),clearAllCharaPosition(),androidSm||iPhone){var n=640*objFrame[e],i=advData.anime[e].img;androidSm&&(i=advData.anime[e].img.replace("scene","scene_sp")),$("#anime").css({"background-image":"url("+IMG_ROOT+i+"?anime="+cacheVersion+")","-webkit-background-size":"854px "+n+"px","-moz-background-size":"854px "+n+"px","background-size":"854px "+n+"px"}),addRotateClass()}else $("#anime").css({"background-image":"url("+IMG_ROOT+advData.anime[e].img+"?anime="+cacheVersion+")","-webkit-background-size":"cover","-moz-background-size":"cover","background-size":"cover"});addCanvasRotate();var o=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"moz":"opera"in window?"o":"",s="";"webkit"!=o&&"moz"!=o&&"o"!=o||(s="-"+o+"-");var r=document.styleSheets[document.styleSheets.length-1],c=objFrame[e],d=Math.round(c/30*100);d/=100;var m=[];m=["0% {background-position:0px 0px;}","100% {background-position:0px "+c*animeHeight*-1+"px;}"];var l="",u="";if(u="finish"===advData.anime[e].type?"animeMotionFinish":"fast"===advData.anime[e].type?"animeMotionFast":"animeMotionNormal","webkit"==o||"moz"==o||"o"==o){for(strClass=".clsAnime { "+s+"animation: "+u+" "+d+"s steps("+c+",end) 0s infinite normal none;}",l="@"+s+"keyframes "+u+" {",a=0;a<m.length;a++)l+=m[a];l+="}"}else for(strClass="animation: "+u+" "+d+"s steps("+c+",end) 0s infinite normal none;",l="",a=0;a<m.length;a++)l+=m[a];if(IE){r.addRule(".clsAnime",strClass),animeCssCnt++;var p=document.createElement("style");p.innerHTML="@keyframes "+u+" {"+l+"}",document.head.appendChild(p)}else r.insertRule(strClass,r.cssRules.length),animeCssCnt++,r.insertRule(l,r.cssRules.length),animeCssCnt++;$("#anime").addClass("clsAnime")}else if(e.match(/illust/))$("#bg").css({"background-image":"none"}),$("#charaCenter").css({"background-image":"none"}),$("#charaLeft").css({"background-image":"none"}),$("#charaRight").css({"background-image":"none"}),clearAllCharaPosition(),$("#anime").css({"background-image":"url("+IMG_ROOT+advData.illust[e].img+"?anime="+cacheVersion+")","background-repeat":"no-repeat","-webkit-background-size":"cover","-moz-background-size":"cover","background-size":"cover"}),(androidSm||iPhone)&&addRotateClass(),addCanvasRotate();else if("charaImage"==e)for(a=0;a<t.charaImage.length;a++)displayCharaImage(t.charaImage[a].img,t.charaImage[a].label,t.charaImage[a].type,t.charaImage[a].x,t.charaImage[a].y,t.charaImage[a].z);else if("charaImageDelete"==e)for(a=0;a<t.charaImageDelete.length;a++){var h="#chara"+t.charaImageDelete[a];$(h).css({"background-image":"none"}),objCharaPosition[t.charaImageDelete[a]].x=objCharaPosition[t.charaImageDelete[a]].originX,objCharaPosition[t.charaImageDelete[a]].y=objCharaPosition[t.charaImageDelete[a]].originY}else if(e.match(/bg/))$("#bg").css({"background-image":"url("+IMG_ROOT+advData.bg[e].img+"?anime="+cacheVersion+")","background-size":"contain","background-repeat":"no-repeat","background-position":"left 0px top 0px"});else if(e.match(/stop/)){var g="#anime.motionNormal";$("#anime").hasClass("motionFast")&&(g="#anime.motionFast"),$(g).css({"animation-play-state":"paused","-webkit-animation-play-state":"paused","-moz-animation-play-state":"paused"})}}function stopAnimeMotion(){var e=!1;if($("#anime").hasClass("clsAnime")&&($("#anime").removeClass("clsAnime"),e=!0),e){var a=document.styleSheets[document.styleSheets.length-1];if(IE){var t=document.head.childNodes[document.head.childNodes.length-1];for(document.head.removeChild(t),a=document.styleSheets[document.styleSheets.length-1];animeCssCnt>0;)a.removeRule(a.rules.length-1),animeCssCnt--}else for(;animeCssCnt>0;)a.deleteRule(a.cssRules.length-1),animeCssCnt--}}function displayCharaImage(e,a,t,n,i,o){var s="#chara"+a,r=e;t==CHARA_TYPE_DARK&&(r=e+"_gray");var c="";c=void 0!=advData.charaImage[r]?advData.charaImage[r].img:advData.charaImage[e].img;$(s).css("width").replace("px","");objCharaPosition[a].x=objCharaPosition[a].originX+n,objCharaPosition[a].y=objCharaPosition[a].originY+i;$(s).css({"background-image":"url("+IMG_ROOT+c+"?anime="+cacheVersion+")","background-size":"contain","background-repeat":"no-repeat","margin-top":objCharaPosition[a].y,"margin-left":objCharaPosition[a].x,"z-index":o})}function addCanvasRotate(){androidSm||iPhone?($("#message").css({width:"774px",height:"107px",padding:"45px 40px 0px 40px"}),$("#charaName").css({width:"300px",height:"30px"}),$("#ready").css({transform:"rotate(90deg)",margin:"214px auto 0px"}),$("#selectButton").css({transform:"rotate(90deg)",top:"407px",left:"-107px"})):($("#soundToggleButton").css({"margin-top":"490px","margin-left":"275px"}),$("#skipButton").css({"margin-top":"485px","margin-left":"750px"}),$("#autoButton").css({"margin-top":"485px","margin-left":"640px"}),$("#repeatButton").css({"margin-top":"485px","margin-left":"514px"}),$("#xButton").css({"margin-top":"600px","margin-left":"810px"}),$("#container").css({width:"854px",height:"640px"}),$("#hitArea").css({width:"854px",height:"640px"}),$("#effect").css({width:"854px",height:"640px"}),$("#message").css({width:"774px",height:"107px",padding:"45px 40px 0px 40px",top:"-214px"}),$("#charaName").css({width:"300px",height:"30px",top:"-214px"}),$("#container").css({top:"50px"}),$("#ready").css({margin:"100px auto 0px"}),$("#selectButton").css({width:"854px",top:"400px"}),$("#btnSoundOn").css({left:"140px"}),$("#btnSoundOff").css({left:"440px"}),$("body").css({"background-image":"url("+commonDir+"ADV_BG_960.jpg?anime="+cacheVersion+")","background-repeat":"no-repeat","background-position":"center top"}),$("#loader").css({"max-width":"854px"})),$("#anime").css({width:"854px",height:"640px"})}function removeCanvasRotate(){androidSm||iPhone||($("#soundToggleButton").css({"margin-top":"705px","margin-left":"195px"}),$("#skipButton").css({"margin-top":"700px","margin-left":"540px"}),$("#autoButton").css({"margin-top":"700px","margin-left":"435px"}),$("#repeatButton").css({"margin-top":"700px","margin-left":"314px"}),$("#xButton").css({"margin-top":"810px","margin-left":"600px"}),$("#container").css({width:"640px",height:"854px"}),$("#hitArea").css({width:"640px",height:"854px"}),$("#effect").css({width:"640px",height:"854px"}),$("#container").css({top:"0px"}),$("#ready").css({margin:"0px auto"}),$("#selectButton").css({width:"640px",top:"300px"}),$("#btnSoundOn").css({left:"140px"}),$("#btnSoundOff").css({left:"334px"}),$("body").css({"background-image":"none"}),$("#loader").css({"max-width":"640px"})),$("#message").css({width:"600px",height:"87px",padding:"45px 20px 0px 20px",top:"0px"}),$("#charaName").css({width:"160px",height:"40px",top:"0px"}),$("#anime").css({width:"640px",height:"854px"})}function addRotateClass(){$("#anime").addClass("rotationAnime"),$("#message").addClass("rotationMessage"),$("#charaName").addClass("rotationCharaName"),$("#repeatButton").addClass("rotationRepeatButton"),$("#autoButton").addClass("rotationAutoButton"),$("#skipButton").addClass("rotationSkipButton"),$("#xButton").addClass("rotationXButton"),$("#soundToggleButton").addClass("rotationSoundToggleButton")}function clearAllCharaPosition(){objCharaPosition.Center.x=objCharaPosition.Center.originX,objCharaPosition.Center.y=objCharaPosition.Center.originY,objCharaPosition.Left.x=objCharaPosition.Left.originX,objCharaPosition.Left.y=objCharaPosition.Left.originY,objCharaPosition.Right.x=objCharaPosition.Right.originX,objCharaPosition.Right.y=objCharaPosition.Right.originY}function MessageWindowObject(){androidSm||iPhone?($("#message").css({"font-size":"1.6rem",width:"600px",height:"107px","margin-top":"704px","margin-left":"0px",padding:"45px 20px 0px 20px",color:"#fff","text-shadow":"black 1px 0px 10px, black 0px 1px 10px, black -1px 0px 10px, black 0px -1px 10px"}),$("#charaName").css({"font-size":"1.6rem",width:"160px",height:"40px","margin-top":"710px","margin-left":"0px",padding:"0px 0px 0px 45px",color:"#fff","text-shadow":"black 1px 0px 10px, black 0px 1px 10px, black -1px 0px 10px, black 0px -1px 10px"})):($("#message").css({"font-size":"1.1rem",width:"600px",height:"102px","margin-top":"702px","margin-left":"0px",padding:"50px 20px 0px 20px",color:"#fff","text-shadow":"black 1px 0px 10px, black 0px 1px 10px, black -1px 0px 10px, black 0px -1px 10px"}),$("#charaName").css({"font-size":"1.1rem",width:"205px",height:"30px","margin-top":"715px","margin-left":"0px",padding:"0px 0px 0px 45px",color:"#fff","text-shadow":"black 1px 0px 10px, black 0px 1px 10px, black -1px 0px 10px, black 0px -1px 10px"})),this.visible=function(e,a){if(null!=e&&e.length>0){var t="";if(e.match(/<font[\d]+>/g)){var n=e.match(/<font[\d]+>/g),i=[],o=0;for(o=0;o<n.length;o++){var s=n[o].replace("<font","");i.push(Number(s.replace(">","")))}for(t=e,o=0;o<n.length;o++)t=t.replace(/<font[\d]+>/,'<span id="font'+i[o]+'">'),t=t.replace("</font>","</span>")}else t=e;var r="";r=g_UserName.length>6?g_UserName.substr(0,5)+"…":g_UserName,t.match(/<USER>/g)&&(t=t.replace(/<USER>/g,r)),t.match(/<user>/g)&&(t=t.replace(/<user>/g,r)),setInnerText(document.getElementById("message"),t),$("#message").css({opacity:1})}else setInnerText(document.getElementById("message"),""),$("#message").css({opacity:0});if(null!=a&&a.length>0){var c=a,d="";d=g_UserName.length>6?g_UserName.substr(0,5)+"…":g_UserName,c.match(/<USER>/g)&&(c=c.replace(/<USER>/g,d)),c.match(/<user>/g)&&(c=c.replace(/<user>/g,d)),setInnerText(document.getElementById("charaName"),c),$("#charaName").css({opacity:1})}else setInnerText(document.getElementById("charaName"),""),$("#charaName").css({opacity:0});$("#charaName").css({color:"#FFFFFF"}),$("#autoButton").css({opacity:1}),$("#skipButton").css({opacity:1}),$("#xButton").css({opacity:1}),$("#repeatButton").css({opacity:1}),$("#soundToggleButton").css({opacity:1})},this.invisible=function(){$("#message").css({opacity:0}),$("#charaName").css({opacity:0}),$("#autoButton").css({opacity:0}),$("#skipButton").css({opacity:0}),$("#xButton").css({opacity:0}),$("#repeatButton").css({opacity:0}),$("#soundToggleButton").css({opacity:0})}}function setInnerText(e,a){if("undefined"==typeof e.innerHTML){for(;e.firstChild;)e.removeChild(e.firstChild);a=a.split("\n").join("<br>");for(var t=a.split("<br>"),n=0;n<t.length;++n)0!=n&&e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode(t[n]))}else a=a.split("\n").join("<br>"),e.innerHTML=a}function scenarioEffectTypeSelect(){for(var e=0,a=0;a<advData.scenario.length;a++){var t=advData.scenario[a].effect;void 0!=t&&"select"==t.type&&(isSelectFlag=!0,selectStartNum[e]=a,e++)}}function onClickHandler(e){var a=e.target;if(!isClickNG)switch(isSoundLoaded||loadSound(),a.id){case"hitArea":if(!isWait&&isStart)if("none"===$("#message").css("display"))$("#message").css({display:"block"}),$("#charaName").css({display:"block"}),isSkipEnable()&&$("#skipButton").css({display:"block"}),$("#autoButton").css({display:"block"}),displayRepeatButton(),$("#xButton").css({display:"block"}),isNoSound||$("#soundToggleButton").css({display:"block"});else{if(isAutoMode())return;isClickNG=!0,stopVoice(),changeNext(),isClickNG=!1}break;case"skipButton":if(!isWait&&isStart){if(1==isSelectFlag&&selectStartNum.length>skipSelectCount)scenarioIndex=selectStartNum[skipSelectCount]-1;else for(;scenarioIndex+1<advData.scenario.length&&void 0==advData.scenario[scenarioIndex+1].skipStop;)scenarioIndex++;scenarioIndex+1>=advData.scenario.length&&(isSkip=!0),isClickNG=!0,stopVoice(),changeNext(),isClickNG=!1}break;case"autoButton":!isWait&&isStart&&(isAutoMode()||isVoicePlaying()?(clearTimeout(autoModeStartTimer),clearTimeout(autoModeTimer)):autoModeStartTimer=setTimeout(changeNext,advData.seting.autoModeDelayTime),changeAutoMode());break;case"xButton":!isWait&&isStart&&($("#message").css({display:"none"}),$("#charaName").css({display:"none"}),$("#skipButton").css({display:"none"}),$("#autoButton").css({display:"none"}),displayRepeatButton(),$("#xButton").css({display:"none"}),$("#soundToggleButton").css({display:"none"}));break;case"repeatButton":!isWait&&isStart&&onClickRepeatButton();break;case"soundToggleButton":!isWait&&isStart&&onClickSoundButton();break;case"btnSoundOn":onClickSoundSetButton("on");break;case"btnSoundOff":onClickSoundSetButton("off")}}function onClickSoundSetButton(e){isClickNG||(isClickNG=!0,initCharaPosition(),changeSoundStatus(e),$("#selectButton").css({display:"none"}),changeNext(),androidSm||iPhone||loadSound(),isWait=!0,$("#ready").css({display:"none"}),offFlashOut("black",500).then(function(){changeNext(),isClickNG=!1,isStart=!0}))}function onAutoStartSoundOff(){isClickNG||(isClickNG=!0,initCharaPosition(),isNoSound=!0,$("#soundToggleButton").css({display:"none"}),$("#selectButton").css({display:"none"}),changeNext(),isWait=!0,$("#ready").css({display:"none"}),offFlashOut("black",500).then(function(){changeNext(),isClickNG=!1,isStart=!0}))}function onClickRepeatButton(){isClickNG||isAutoMode()||(isClickNG=!0,repeatVoice(),isClickNG=!1)}function changeNext(){isClickNG=!0,nextScenario().then(function(){isClickNG=!!isWait})}function nextScenario(){var def=$.Deferred();if(scenarioIndex++,messageWindow.invisible(),displayRepeatButton(!1),stopShake(),scenarioIndex>=advData.scenario.length){hitArea.addEventListener?hitArea.removeEventListener("click",onClickHandler,!1):hitArea.attachEvent&&hitArea.detachEvent("onclick",onClickHandler),messageWindow.invisible();var className="#anime.motionNormal";$("#anime").hasClass("motionFast")&&(className="#anime.motionFast"),$(className).css({"animation-play-state":"paused","-webkit-animation-play-state":"paused","-moz-animation-play-state":"paused"}),document.getElementById("anime").style.opacity=0,stopVoice(),removeCanvasRotate(),g_expand;var at=isAutoTap?1:0,sk=isSkip?1:0,sound=isMute?0:1,url="";url=g_NextURL.match(/\?/g)?isSelectFlag?g_NextURL+"&auto="+at+"&skip="+sk+"&so="+sound+selectParam:g_NextURL+"&auto="+at+"&skip="+sk+"&so="+sound:isSelectFlag?g_NextURL+"?auto="+at+"&skip="+sk+"&so="+sound+selectParam:g_NextURL+"?auto="+at+"&skip="+sk+"&so="+sound,isEnd||(isEnd=!0,location.href=url)}else{var scenario=advData.scenario[scenarioIndex],isSoundPlay=!1;if(scenario.hasOwnProperty("voice")&&(stopVoice(),playVoice(scenario.voice),isMute||(isSoundPlay=!0)),scenario.hasOwnProperty("animation")?changeImage(scenario.animation):scenario.hasOwnProperty("illust")?changeImage(scenario.illust):(scenario.hasOwnProperty("charaImage")&&changeImage("charaImage"),scenario.hasOwnProperty("charaImageDelete")&&changeImage("charaImageDelete"),scenario.hasOwnProperty("bg")&&changeImage(scenario.bg)),scenario.hasOwnProperty("effect")){var effectType=scenario.effect.type,effectDuration=scenario.effect.duration;if("shake"==effectType||"jump"==effectType){isWait=!1;var aryTarget=scenario.effect.Target,effUpdateTime=scenario.effect.updateTime,effAnimeCount=scenario.effect.animeCount,effXMin=scenario.effect.xMin,effXMax=scenario.effect.xMax,effYMin=scenario.effect.yMin,effYMax=scenario.effect.yMax;if(startShake(effectType,aryTarget,effUpdateTime,effectDuration,effXMin,effXMax,effYMin,effYMax),scenario.hasOwnProperty("message")){var charaName=null;if(scenario.hasOwnProperty("charaName"))var charaName=scenario.charaName;messageWindow.visible(scenario.message,charaName)}!isSoundPlay&&isAutoMode()&&(autoModeTimer=setTimeout(changeNext,3e3))}else if("onFlashOut"==effectType||"offFlashOut"==effectType||"keepFlash"==effectType){isWait=!0;var effectColor=scenario.effect.color;eval(effectType+'("'+effectColor+'",'+effectDuration+").then(function(){changeNext();});")}else if("charaFadeIn"==effectType||"charaFadeOut"==effectType){isWait=!0;var aryTarget=scenario.effect.Target;eval(effectType+"(aryTarget, "+effectDuration+").then(function(){changeNext();});")}else if("charaSlideIn"==effectType||"charaSlideOut"==effectType){isWait=!0;var aryTarget=scenario.effect.Target,effDirection=scenario.effect.direction;eval(effectType+"(aryTarget, effDirection, "+effectDuration+").then(function(){changeNext();});")}else if("select"==effectType){$("#hitArea,#xButton,#soundToggleButton,#autoButton,#skipButton,#charaName,#message").css({display:"none"});var selectLeftName=scenario.effect.selectLeftName,selectRightName=scenario.effect.selectRightName,selectLeftParam=scenario.effect.selectLeftParam,selectRightParam=scenario.effect.selectRightParam;selectedBranch(effectType,selectLeftName,selectRightName,selectLeftParam,selectRightParam),skipSelectCount++}}else{if(isWait=!1,scenario.hasOwnProperty("message")){var charaName=null;if(scenario.hasOwnProperty("charaName"))var charaName=scenario.charaName;messageWindow.visible(scenario.message,charaName)}!isSoundPlay&&isAutoMode()&&(autoModeTimer=setTimeout(changeNext,3e3))}}return def.resolve(),def.promise()}function selectedBranch(e,a,t,n,i){function o(e,a){$("#hitArea,#xButton,#autoButton,#skipButton,#charaName,#message").css({display:"block"}),a=a.replace("advID","nextID"),selectParam+=a,displayRepeatButton(),isNoSound||$("#soundToggleButton").css({display:"block"}),d.hide(),stopVoice(),changeNext()}var s=$("#selectBtn1"),r=$("#selectBtn2"),c=$("#selectBtn1,#selectBtn2"),d=$("#selectFrame,#selectBtn1,#selectBtn2");setTimeout(function(){d.show()},500),s.html(a),r.html(t),s.on("click",function(){var e=n;c.off("click"),o(s,e)}),r.on("click",function(){var e=i;c.off("click"),o(r,e)})}function onFlashOut(type,opt_duration){function checkAnimeEnd(){for(eval("var cssObj = {'background-color':'', '"+vp+"animation-name':'', '"+vp+"animation-duration':''};"),$("."+animeClass).css(cssObj),$("#effect").removeClass(animeClass);addCssCnt>0;){var element=document.head.childNodes[document.head.childNodes.length-1];document.head.removeChild(element),addCssCnt--}def.resolve()}var def=$.Deferred(),dura=opt_duration/1e3+"s",animeClass="effectFadeIn",color="";"white"==type?color="rgba(255, 255, 255, 1)":"black"==type&&(color="rgba(0, 0, 0, 1)");var prm=["0% { opacity: 0; } ","100%{ opacity: 1; }"];AnimeNameCnt++;var vendor=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"moz":"opera"in window?"o":"",vp="",endName="animationend";"webkit"!=vendor&&"o"!=vendor||(vp="-"+vendor+"-",endName=vendor+"AnimationEnd");for(var strKeyframe="@"+vp+"keyframes Animation"+AnimeNameCnt+" {",i=0;i<prm.length;i++)strKeyframe+=prm[i];strKeyframe+="}";var cssAnimation=document.createElement("style");return cssAnimation.innerHTML=strKeyframe,document.head.appendChild(cssAnimation),addCssCnt++,$("#effect").addClass(animeClass),eval("var cssObj = {'background-color':'"+color+"', '"+vp+"animation-name':'Animation"+AnimeNameCnt+"', '"+vp+"animation-duration':'"+dura+"'};"),$("."+animeClass).css(cssObj),$("."+animeClass).one(endName,function(){checkAnimeEnd()}),def.promise()}function offFlashOut(type,opt_duration){function checkAnimeEnd(){for(eval("var cssObj = {'background-color':'', '"+vp+"animation-name':'', '"+vp+"animation-duration':''};"),$("."+animeClass).css(cssObj),$("#effect").removeClass(animeClass);addCssCnt>0;){var element=document.head.childNodes[document.head.childNodes.length-1];document.head.removeChild(element),addCssCnt--}def.resolve()}var def=$.Deferred(),dura=opt_duration/1e3+"s",animeClass="effectFadeOut",color="";"white"==type?color="rgba(255, 255, 255, 1)":"black"==type&&(color="rgba(0, 0, 0, 1)");var prm=["0% { opacity: 1; } ","100%{ opacity: 0; }"];AnimeNameCnt++;var vendor=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"moz":"opera"in window?"o":"",vp="",endName="animationend";"webkit"!=vendor&&"o"!=vendor||(vp="-"+vendor+"-",endName=vendor+"AnimationEnd");for(var strKeyframe="@"+vp+"keyframes Animation"+AnimeNameCnt+" {",i=0;i<prm.length;i++)strKeyframe+=prm[i];strKeyframe+="}";var cssAnimation=document.createElement("style");return cssAnimation.innerHTML=strKeyframe,document.head.appendChild(cssAnimation),addCssCnt++,$("#effect").addClass(animeClass),eval("var cssObj = {'background-color':'"+color+"', '"+vp+"animation-name':'Animation"+AnimeNameCnt+"', '"+vp+"animation-duration':'"+dura+"'};"),$("."+animeClass).css(cssObj),$("."+animeClass).one(endName,function(){checkAnimeEnd()}),def.promise()}function keepFlash(e,a){var t=$.Deferred(),n="";return"white"==e?n="rgba(255, 255, 255, 1)":"black"==e&&(n="rgba(0, 0, 0, 1)"),$("#effect").css({"background-color":n}),setTimeout(function(){t.resolve()},a),t.promise()}function charaFadeIn(aryTarget,opt_duration){function checkAnimeEnd(){if(count==aryTarget.length){eval("var cssObj = {'"+vp+"animation-name':'', '"+vp+"animation-duration':''};"),$("."+animeClass).css(cssObj);for(var j=0;j<aryTarget.length;j++)$("#chara"+aryTarget[j]).removeClass(animeClass);for(;addCssCnt>0;){var element=document.head.childNodes[document.head.childNodes.length-1];document.head.removeChild(element),addCssCnt--}def.resolve()}}var def=$.Deferred(),i=0,count=0,dura=opt_duration/1e3+"s",animeClass="fadeIn",prm=["0% { opacity: 0; } ","100%{ opacity: 1; }"];AnimeNameCnt++;var vendor=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"moz":"opera"in window?"o":"",vp="",endName="animationend";"webkit"!=vendor&&"o"!=vendor||(vp="-"+vendor+"-",endName=vendor+"AnimationEnd");for(var strKeyframe="@"+vp+"keyframes Animation"+AnimeNameCnt+" {",i=0;i<prm.length;i++)strKeyframe+=prm[i];strKeyframe+="}";var cssAnimation=document.createElement("style");for(cssAnimation.innerHTML=strKeyframe,document.head.appendChild(cssAnimation),addCssCnt++,i=0;i<aryTarget.length;i++)$("#chara"+aryTarget[i]).addClass(animeClass);for(eval("var cssObj = {'"+vp+"animation-name':'Animation"+AnimeNameCnt+"', '"+vp+"animation-duration':'"+dura+"'};"),$("."+animeClass).css(cssObj),i=0;i<aryTarget.length;i++)$("#chara"+aryTarget[i]).one(endName,function(){count++,checkAnimeEnd()});return def.promise()}function charaFadeOut(aryTarget,opt_duration){function checkAnimeEnd(){if(count==aryTarget.length){eval("var cssObj = {'"+vp+"animation-name':'', '"+vp+"animation-duration':''};"),$("."+animeClass).css(cssObj);for(var j=0;j<aryTarget.length;j++)$("#chara"+aryTarget[j]).css({"background-image":"none"}),$("#chara"+aryTarget[j]).removeClass(animeClass);for(;addCssCnt>0;){var element=document.head.childNodes[document.head.childNodes.length-1];document.head.removeChild(element),addCssCnt--}def.resolve()}}var def=$.Deferred(),i=0,count=0,dura=opt_duration/1e3+"s",animeClass="fadeOut",prm=["0% { opacity: 1; } ","100%{ opacity: 0; }"];AnimeNameCnt++;var vendor=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"moz":"opera"in window?"o":"",vp="",endName="animationend";"webkit"!=vendor&&"o"!=vendor||(vp="-"+vendor+"-",endName=vendor+"AnimationEnd");for(var strKeyframe="@"+vp+"keyframes Animation"+AnimeNameCnt+" {",i=0;i<prm.length;i++)strKeyframe+=prm[i];strKeyframe+="}";var cssAnimation=document.createElement("style");for(cssAnimation.innerHTML=strKeyframe,document.head.appendChild(cssAnimation),addCssCnt++,i=0;i<aryTarget.length;i++)$("#chara"+aryTarget[i]).addClass(animeClass);for(eval("var cssObj = {'"+vp+"animation-name':'Animation"+AnimeNameCnt+"', '"+vp+"animation-duration':'"+dura+"'};"),$("."+animeClass).css(cssObj),i=0;i<aryTarget.length;i++)$("#chara"+aryTarget[i]).one(endName,function(){count++,checkAnimeEnd()});return def.promise()}function charaSlideOut(aryTarget,direction,opt_duration){function checkAnimeEnd(){if(count==aryTarget.length){eval("var cssObj = {'"+vp+"animation-name':'', '"+vp+"animation-duration':''};"),$("."+animeClass).css(cssObj);for(var j=0;j<aryTarget.length;j++)$("#chara"+aryTarget[j]).css({"background-image":"none"}),$("#chara"+aryTarget[j]).removeClass(animeClass);for(;addCssCnt>0;){var element=document.head.childNodes[document.head.childNodes.length-1];document.head.removeChild(element),addCssCnt--}def.resolve()}}var def=$.Deferred(),i=0,count=0,dura=opt_duration/1e3+"s",animeClass="";AnimeNameCnt++;var vendor=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"moz":"opera"in window?"o":"",vp="",endName="animationend";"webkit"!=vendor&&"o"!=vendor||(vp="-"+vendor+"-",endName=vendor+"AnimationEnd");var prm=[];"right"==direction||"Right"==direction?(animeClass="slideOutRight",prm=["0% { "+vp+"transform: translate(0px); } ","100%{ "+vp+"transform: translate(1000px); }"]):"left"!=direction&&"Left"!=direction||(animeClass="slideOutLeft",prm=["0% { "+vp+"transform: translate(0px); } ","100%{ "+vp+"transform: translate(-1000px); }"]);for(var strKeyframe="@"+vp+"keyframes Animation"+AnimeNameCnt+" {",i=0;i<prm.length;i++)strKeyframe+=prm[i];strKeyframe+="}";var cssAnimation=document.createElement("style");for(cssAnimation.innerHTML=strKeyframe,document.head.appendChild(cssAnimation),addCssCnt++,i=0;i<aryTarget.length;i++)$("#chara"+aryTarget[i]).addClass(animeClass);for(eval("var cssObj = {'"+vp+"animation-name':'Animation"+AnimeNameCnt+"', '"+vp+"animation-duration':'"+dura+"'};"),$("."+animeClass).css(cssObj),i=0;i<aryTarget.length;i++)$("#chara"+aryTarget[i]).one(endName,function(){count++,checkAnimeEnd()});return def.promise()}function charaSlideIn(aryTarget,direction,opt_duration){function checkAnimeEnd(){if(count==aryTarget.length){eval("var cssObj = {'"+vp+"animation-name':'', '"+vp+"animation-duration':''};"),$("."+animeClass).css(cssObj);for(var j=0;j<aryTarget.length;j++)$("#chara"+aryTarget[j]).removeClass(animeClass);for(;addCssCnt>0;){var element=document.head.childNodes[document.head.childNodes.length-1];document.head.removeChild(element),addCssCnt--}def.resolve()}}var def=$.Deferred(),i=0,count=0,dura=opt_duration/1e3+"s",animeClass="";AnimeNameCnt++;var vendor=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"moz":"opera"in window?"o":"",vp="",endName="animationend";"webkit"!=vendor&&"o"!=vendor||(vp="-"+vendor+"-",endName=vendor+"AnimationEnd");var prm=[];"right"==direction||"Right"==direction?(animeClass="slideInRight",prm=["0% { "+vp+"transform: translate(-1000px); } ","100%{ "+vp+"transform: translate(0px); }"]):"left"!=direction&&"Left"!=direction||(animeClass="slideInLeft",prm=["0% { "+vp+"transform: translate(1000px); } ","100%{ "+vp+"transform: translate(0px); }"]);for(var strKeyframe="@"+vp+"keyframes Animation"+AnimeNameCnt+" {",i=0;i<prm.length;i++)strKeyframe+=prm[i];strKeyframe+="}";var cssAnimation=document.createElement("style");for(cssAnimation.innerHTML=strKeyframe,document.head.appendChild(cssAnimation),addCssCnt++,i=0;i<aryTarget.length;i++)$("#chara"+aryTarget[i]).addClass(animeClass);for(eval("var cssObj = {'"+vp+"animation-name':'Animation"+AnimeNameCnt+"', '"+vp+"animation-duration':'"+dura+"'};"),$("."+animeClass).css(cssObj),
i=0;i<aryTarget.length;i++)$("#chara"+aryTarget[i]).one(endName,function(){count++,checkAnimeEnd()});return def.promise()}function startShake(e,a,t,n,i,o,s,r){function c(){AnimeNameCnt++;var i=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"moz":"opera"in window?"o":"",o="";"webkit"!=i&&"o"!=i||(o="-"+i+"-");var s=[],c="";"shake"==e?(s=["0% { "+o+"transform: translate3d("+l+", "+b+", 0); } ","10% { "+o+"transform: translate3d("+h+", "+f+", 0); } ","20% { "+o+"transform: translate3d(0, 0, 0); } ","30% { "+o+"transform: translate3d("+p+", "+v+", 0); } ","40% { "+o+"transform: translate3d("+u+", 0, 0); } ","50% { "+o+"transform: translate3d("+l+", "+f+", 0); } ","60% { "+o+"transform: translate3d(0, "+g+", 0); } ","70% { "+o+"transform: translate3d("+h+", 0, 0); } ","80% { "+o+"transform: translate3d("+p+", "+b+", 0); } ","90% { "+o+"transform: translate3d("+u+", "+v+", 0); } ","100% { "+o+"transform: translate3d(0, 0, 0); }"],c=t*(s.length-1)/1e3+"s"):"jump"==e&&(s=["0% { "+o+"transform: scale(1, 1) translate3d(0, 0, 0); } ","20%{ "+o+"transform: scale(1, 1) translate3d(0, "+b+", 0); } ","40%{ "+o+"transform: scale(1, 1) translate3d(0, "+r*-1*.6+", 0); } ","100%{ "+o+"transform: scale(1, 1) translate3d(0, 0, 0);} "],c=n/1e3+"s");var d="",y="",C=0;for("shake"==e?y=".shake { "+o+"animation: Animation"+AnimeNameCnt+" "+c+" linear infinite;}":"jump"==e&&(y=".shake { "+o+"animation: Animation"+AnimeNameCnt+" "+c+" ease-in infinite;}"),d="@"+o+"keyframes Animation"+AnimeNameCnt+" {",C=0;C<s.length;C++)d+=s[C];d+="}";var x=document.createElement("style");x.innerHTML=y,document.head.appendChild(x),addCssCnt++;var k=document.createElement("style");if(k.innerHTML=d,document.head.appendChild(k),addCssCnt++,m)$("#bg").addClass("shake"),$("#charaLeft").addClass("shake"),$("#charaRight").addClass("shake"),$("#charaCenter").addClass("shake");else for(C=0;C<a.length;C++)$("#chara"+a[C]).addClass("shake")}var d=0,m=!1;for(d=0;d<a.length;d++)if("screen"==a[d]){m=!0;break}var l=i+"px",u=i*-1+"px",p=o+"px",h=o+-1+"px",g=s+"px",f=s*-1+"px",v=r+"px",b=r*-1+"px";shakeCssCnt=0,c(),n>=0&&(shakeTimer=setTimeout(function(){stopShake()},n))}function stopShake(){var e=!1;if($("#bg").hasClass("shake")&&($("#bg").removeClass("shake"),e=!0),$("#charaLeft").hasClass("shake")&&($("#charaLeft").removeClass("shake"),e=!0),$("#charaRight").hasClass("shake")&&($("#charaRight").removeClass("shake"),e=!0),$("#charaCenter").hasClass("shake")&&($("#charaCenter").removeClass("shake"),e=!0),e)for(clearTimeout(shakeTimer);addCssCnt>0;){var a=document.head.childNodes[document.head.childNodes.length-1];document.head.removeChild(a),addCssCnt--}}function tuningEffect(e){setInterval(function(){tuning(e)},1e3)}function tuning(e,a,t){var n=a,i=t,o=Math.floor(50*Math.random()),s=o-25+n,r=o-25+i;$("#"+e).css({top:s+"px",left:r+"px"})}function loadSound(){isSoundLoaded=!0,objVoiceAudio=new Array;var e=advData.voice;for(var a in e){var t=SOUND_ROOT+e[a].sound;getSoundData(a,t),soundNum++}soundNum<1&&(isNoSound=!0,$("#soundToggleButton").css({display:"none"}))}function getSoundData(e,a){objVoiceAudio[e]=null;try{if(objVoiceAudio[e]=new Audio(""),objVoiceAudio[e].canPlayType){var t=""!=objVoiceAudio[e].canPlayType("audio/ogg"),n=""!=objVoiceAudio[e].canPlayType("audio/mpeg");t?(objVoiceAudio[e].autoplay=!1,objVoiceAudio[e].volume=.5,objVoiceAudio[e].loop=!1,objVoiceAudio[e].src=a+".ogg?anime="+cacheVersion,objVoiceAudio[e].load()):n&&(objVoiceAudio[e].autoplay=!1,objVoiceAudio[e].volume=.5,objVoiceAudio[e].loop=!1,objVoiceAudio[e].src=a+".mp3?anime="+cacheVersion,objVoiceAudio[e].load())}}catch(i){objVoiceAudio[e]=null}}function playVoice(e){isSoundLoaded&&!isNoSound&&(displayRepeatButton(!1),objVoiceAudio[e].loop=!1,changeVolume(isMute,e),iPhone||iPad?isMute||(objVoiceAudio[e].play(),objVoiceAudio[e].addEventListener("ended",soundEnded,!1),objVoiceAudio[e].addEventListener("timeupdate",soundPlaying,!1)):isMute||(objVoiceAudio[e].play(),objVoiceAudio[e].addEventListener("ended",soundEnded,!1),objVoiceAudio[e].addEventListener("timeupdate",soundPlaying,!1)),playingVoiceName=e)}function repeatVoice(){displayRepeatButton(!1),objVoiceAudio[playingVoiceName].pause(),objVoiceAudio[playingVoiceName].currentTime=0,objVoiceAudio[playingVoiceName].play(),objVoiceAudio[playingVoiceName].addEventListener("ended",soundEnded,!1),objVoiceAudio[playingVoiceName].addEventListener("timeupdate",soundPlaying,!1)}function stopVoice(){""!==playingVoiceName&&(objVoiceAudio[playingVoiceName].removeEventListener("timeupdate",soundPlaying,!1),objVoiceAudio[playingVoiceName].removeEventListener("ended",soundEnded,!1),objVoiceAudio[playingVoiceName].pause(),isVoicePlay=!1)}function soundEnded(){objVoiceAudio[playingVoiceName].removeEventListener("timeupdate",soundPlaying,!1),objVoiceAudio[playingVoiceName].removeEventListener("ended",soundEnded,!1),isVoicePlay=!1,isMute||playingVoiceName!==advData.scenario[scenarioIndex].voice?displayRepeatButton(!1):isAutoMode()?changeNext():displayRepeatButton(!0)}function soundPlaying(){isVoicePlay=!0}function isVoicePlaying(){return isVoicePlay}function changeVolume(e,a){e&&stopVoice()}function onClickSoundButton(){isClickNG||(isClickNG=!0,changeSoundStatus(),isClickNG=!1)}function changeSoundStatus(e){null==e?flag=isMute:"on"==e?flag=!0:"off"==e&&(flag=!1),flag?(isMute=!1,playingVoiceName&&playingVoiceName===advData.scenario[scenarioIndex].voice&&!isVoicePlaying()&&displayRepeatButton(!0),$("#soundToggleButton").css({"background-image":'url("'+IMG_ROOT+"anime/common/adv/Note.png?anime="+cacheVersion+'")'}),isAutoMode()&&changeAutoMode()):(isMute=!0,displayRepeatButton(!1),$("#soundToggleButton").css({"background-image":'url("'+IMG_ROOT+"anime/common/adv/Note_off.png?anime="+cacheVersion+'")'}),isAutoMode()&&changeAutoMode()),""!==playingVoiceName&&changeVolume(isMute,playingVoiceName)}function displayRepeatButton(e){void 0==e&&(e=isRepeatOK),isRepeatOK=e,isRepeatOK&&"block"===$("#message").css("display")?$("#repeatButton").css({display:"block"}):$("#repeatButton").css({display:"none"})}function changeAutoMode(){isAuto=!isAuto,isAuto?(isAutoTap=!0,function(e){e("#autoButton").css({"background-image":'url("'+IMG_ROOT+"anime/common/adv/button_auto_on.png?anime="+cacheVersion+'")'})}(jQuery)):(!function(e){e("#autoButton").css({"background-image":'url("'+IMG_ROOT+"anime/common/adv/button_auto.png?anime="+cacheVersion+'")'})}(jQuery),clearTimeout(autoModeStartTimer),clearTimeout(autoModeTimer))}function isAutoMode(){return isAuto}function isSkipEnable(){return advData.seting.skipButton}var ua=navigator.userAgent,IE=ua.match(/msie/i)||ua.match(/Trident/i),IE6=ua.match(/msie [6.]/i),IE7=ua.match(/msie [7.]/i),IE8=ua.match(/msie [8.]/i),IE9=ua.match(/msie [9.]/i),IE10=ua.match(/msie [10.]/i),IE11=ua.match(/msie [11.]/i),Chrome=ua.match(/chrome/i),Safari=ua.match(/safari/i),fireFox=ua.match(/firefox/i),Opera=ua.match(/opera/i),androidTab=!1,androidSm=ua.match(/Android/i)&&ua.match(/Mobile/i)||ua.match(/Android/i)&&!ua.match(/Mobile/i),iPhone=ua.match(/iPhone/i)||ua.match(/iPad/i)||ua.match(/iPod/i),iPad=!1,hitArea,animeWidth=854,animeHeight=640,imageWidth,imageHeight,scenarioIndex=-1,objFrame={},objVoiceAudio={},objBG={},objCharaImage={},objIllust={},animeNum=0,soundNum=0,charaImageNum=0,bgNum=0,illustNum=0;const IMG_ROOT=g_RootPath,SOUND_ROOT=g_RootPath;var isClickNG=!1,isStart=!1,isEnd=!1,isWait=!1,isMute=!0,volsize=0,playingVoiceName="",isVoicePlay=!1,isNoSound=!1,isAuto=!1,isAutoTap=!1,isRepeatOK=!1,isSkip=!1,autoModeTimer,autoModeStartTimer,shakeTimer="",addCssCnt=0,AnimeNameCnt=0,animeCssCnt=0,isSelectFlag=!1,selectStartNum=[],selectParam=new String,skipSelectCount=0,FPS=0,isSoundLoaded=!1,objCharaPosition={Center:{x:0,y:0,originX:0,originY:0},Left:{x:0,y:0,originX:0,originY:0},Right:{x:0,y:0,originX:0,originY:0}},CHARA_TYPE_DARK=0,CHARA_TYPE_BRIGHT=1,supportTouch="ontouchend"in document,EVENT_TOUCH=supportTouch?"touchstart":"mousedown";androidSm||iPhone||(EVENT_TOUCH="mousedown");var messageWindow=new MessageWindowObject,data={},commonDir=g_RootPath+"anime/common/adv/";scenarioEffectTypeSelect(),initialize()}(jQuery);