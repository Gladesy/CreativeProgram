function setInnerText(e,t){if("undefined"==typeof e.innerText){for(;e.firstChild;)e.removeChild(e.firstChild);t=t.split("\n").join("<br>");for(var a=t.split("<br>"),n=0;n<a.length;++n)0!=n&&e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode(a[n]))}else e.innerText=t}function setCssImageUrl(){for(key in setCss)for(key2 in setCss[key])if("background-image"==key2){var e=setCss[key][key2].split('"'),t=e[1];setCss[key][key2]='url("'+commonDir+t+"?anime="+cacheVersion+'")'}}function loadCommonImages(){g_strTexturePath=g_RootPath+g_strTexturePath,$("#hand").css("background-image","url("+commonDir+"hand3.png?anime="+cacheVersion+")"),$("#skipButton").css("background-image","url("+commonDir+"button_skip.png?anime="+cacheVersion+")"),$("#soundToggleButton").css("background-image","url("+commonDir+"Note.png?anime="+cacheVersion+")"),$("#ready").css({"background-image":"url("+commonDir+"../adv/voice_confirm.png?anime="+cacheVersion+")","background-repeat":"no-repeat","background-position":"center"}),$("#btnSoundOn").css("background-image","url("+commonDir+"../adv/button_reproduce.png?anime="+cacheVersion+")"),$("#btnSoundOff").css("background-image","url("+commonDir+"../adv/button_notReproduce.png?anime="+cacheVersion+")")}function PlayFaceAnime(e,t,a,n){(void 0==n||null==n||n<0)&&(n=0),faceStartTime=20*(e+n-1)+1,faceStartTime>g_EntityUI.GetEndFrameTime(indexFace)&&(faceStartTime=20*(defaultFaceNumber-1)+1),faceEndTime=faceStartTime+19;var o=faceStartTime,i=faceEndTime;a==ANIME_OFF&&(i=o),g_EntityUI.PlayAnime(indexFace,o,i,t)}function isSmartphone(){var e=!1;return(androidSp||iPhone||androidTab||iPad)&&(e=!0),e}function rotateTapAreaAjust(){for(var e in tapArea){var t={};t.x=640-(tapArea[e].y+tapArea[e].h),t.y=tapArea[e].x,t.w=tapArea[e].h,t.h=tapArea[e].w,tapArea[e]=t}}function loadSound(){objVoiceAudio=new Array;var e=voice;for(var t in e){var a=g_RootPath+"sound/card/touch/"+e[t].sound;getSoundData(t,a)}}function getSoundData(e,t){objVoiceAudio[e]=null;try{if(objVoiceAudio[e]=new Audio(""),objVoiceAudio[e].canPlayType){var a=""!=objVoiceAudio[e].canPlayType("audio/ogg"),n=(""!=objVoiceAudio[e].canPlayType("audio/mpeg"),""!=objVoiceAudio[e].canPlayType("audio/mp3"));""!=objVoiceAudio[e].canPlayType("audio/mpg"),""!=objVoiceAudio[e].canPlayType("audio/mp4"),""!=objVoiceAudio[e].canPlayType("audio/wav");a?(objVoiceAudio[e].autoplay=!1,objVoiceAudio[e].volume=1,objVoiceAudio[e].loop=!1,objVoiceAudio[e].src=t.replace(".mp3",".ogg")+"?anime="+cacheVersion,objVoiceAudio[e].load()):n&&(objVoiceAudio[e].autoplay=!1,objVoiceAudio[e].volume=1,objVoiceAudio[e].loop=!1,objVoiceAudio[e].src=t+"?anime="+cacheVersion,objVoiceAudio[e].load())}}catch(o){objVoiceAudio[e]=null}}function playVoice(e){stopVoice(),objVoiceAudio[e].loop=!1,changeVolume(isMute,e),iPhone||iPad?isMute||(objVoiceAudio[e].play(),objVoiceAudio[e].addEventListener("ended",soundEnded,!1),objVoiceAudio[e].addEventListener("timeupdate",soundPlaying,!1)):isMute||(objVoiceAudio[e].play(),objVoiceAudio[e].addEventListener("ended",soundEnded,!1),objVoiceAudio[e].addEventListener("timeupdate",soundPlaying,!1)),playingVoiceName=e}function stopVoice(){""!==playingVoiceName&&(objVoiceAudio[playingVoiceName].removeEventListener("timeupdate",soundPlaying,!1),objVoiceAudio[playingVoiceName].removeEventListener("ended",soundEnded,!1),objVoiceAudio[playingVoiceName].pause(),objVoiceAudio[playingVoiceName].currentTime=0,isVoicePlay=!1)}function soundEnded(){objVoiceAudio[playingVoiceName].removeEventListener("timeupdate",soundPlaying,!1),objVoiceAudio[playingVoiceName].removeEventListener("ended",soundEnded,!1),isVoicePlay=!1,isEnd||isOpeningSerifEnd||(hideSerif(),isOpeningSerifEnd=!0),isEnd&&changeNextPage()}function onClickSoundButton(){changeSoundStatus()}function changeSoundStatus(e){null==e?flag=isMute:"on"==e?flag=!0:"off"==e&&(flag=!1),flag?(isMute=!1,$("#soundToggleButton").css({"background-image":'url("'+commonDir+"Note.png?anime="+cacheVersion+'")'})):(isMute=!0,$("#soundToggleButton").css({"background-image":'url("'+commonDir+"Note_off.png?anime="+cacheVersion+'")'})),""!==playingVoiceName&&changeVolume(isMute,playingVoiceName),isStart&&!isOpeningSerifEnd&&isMute&&null==serifTimer&&(serifTimer=setTimeout(function(){hideSerif()},2e3)),isEnd&&isMute&&null==serifTimer&&(serifTimer=setTimeout(function(){changeNextPage()},2e3))}function changeVolume(e,t){e&&stopVoice()}function soundPlaying(){isVoicePlay=!0}function isVoicePlaying(){return isVoicePlay}function setOnomatope(){!function(e){onomatopePos={};for(var t=0,a=0,n=0,o=0,i=1;void 0!==setCss["onomatope"+i];i++)t=setCss["onomatope"+i].left+"px",a=setCss["onomatope"+i].top+"px",n=setCss["onomatope"+i].width+"px",o=setCss["onomatope"+i].height+"px",e("#onomatope"+i).css({top:a,left:t,width:n,height:o}),onomatopePos["pos"+i]={},onomatopePos["pos"+i]={x:t,y:a}}(jQuery)}function playOnomatope(e,t){var a=e+1,n=t+1,o="onomatope"+a;$("#"+o).hasClass("effect"+n)||(onomatopeDelay[o]=0,effectBind("onomatope"+a,"effect"+n,onomatopePos["pos"+a].y,onomatopePos["pos"+a].x))}function stopOnomatope(e){!function(t){var a,n=e+1,o="onomatope"+n,i="";for(a=1;a<=4;a++)if(t("#"+o).hasClass("effect"+a)){i="effect"+a;break}""!=i&&(effectUnbind(o,i),onomatopeDelay[o]=0)}(jQuery)}function effectBind(e,t,a,n){!function(o){o("#"+e).addClass(t),o("#"+e+"."+t).bind("webkitAnimationIteration animationiteration MSAnimationIteration",function(){tuning(e,t,a,n)});var i="-webkit-animation",r="animation",c=(setCss[e][i],setCss[e][r],.1*Math.floor(5*Math.random()));onomatopeDelay[e]=c}(jQuery)}function effectUnbind(e,t){!function(a){a("#"+e+"."+t).unbind("webkitAnimationIteration animationiteration MSAnimationIteration"),a("#"+e).removeAttr("style"),a("#"+e).removeClass(t)}(jQuery)}function tuning(e,t,a,n){var o=parseInt(a.replace("px","")),i=parseInt(n.replace("px","")),r=100,c=Math.floor(Math.random()*r)-r/2,s=c+o,p=c+i,d="background-image",u="-webkit-animation",m="animation",h=setCss[e][d],l=setCss[e][u],f=setCss[e][m];l=l.replace("0.0s",onomatopeDelay[e]+"s"),f=f.replace("0.0s",onomatopeDelay[e]+"s"),function(a){a("#"+e).css({top:s+"px",left:p+"px"}),a("."+t).css({"background-image":h,"-webkit-animation":l,animation:f}),isSmartphone()||a("#"+e).css({"margin-top":"50px","margin-left":"110px"})}(jQuery)}function playHeart(){stopHeart(),heartBind(heartX-18/resRatio/pageZoom,heartY-30/resRatio/pageZoom)}function stopHeart(){!function(e){heartUnbind(1),heartUnbind(2),heartUnbind(3)}(jQuery)}function heartBind(e,t){var a;!function(n){for(n("#heart1").addClass("fly1"),n("#heart2").addClass("fly2"),n("#heart3").addClass("fly3"),n(".fly1").css("background-image","url("+commonDir+"heart.png?anime="+cacheVersion+")"),n(".fly2").css("background-image","url("+commonDir+"heart.png?anime="+cacheVersion+")"),n(".fly3").css("background-image","url("+commonDir+"heart.png?anime="+cacheVersion+")"),n("#heart1.fly1").bind("webkitAnimationIteration animationiteration MSAnimationIteration",function(){heartUnbind1()}),n("#heart2.fly2").bind("webkitAnimationIteration animationiteration MSAnimationIteration",function(){heartUnbind2()}),n("#heart3.fly3").bind("webkitAnimationIteration animationiteration MSAnimationIteration",function(){heartUnbind3()}),a=1;a<=3;a++)if(isSmartphone()){var o=Number(n("#heart"+a).css("width").replace("px","")),i=Number(n("#heart"+a).css("height").replace("px",""));n("#heart"+a).css({top:(640*pageZoom-e/pageZoom-i*pageZoom)/pageZoom+"px",left:(t-o/2)/pageZoom/pageZoom+"px"})}else n("#heart"+a).css({top:t+"px",left:e+"px"}),n("#heart"+a).css({"margin-top":"50px","margin-left":"110px"})}(jQuery)}function heartUnbind1(){heartUnbind(1)}function heartUnbind2(){heartUnbind(2)}function heartUnbind3(){heartUnbind(3)}function heartUnbind(e){!function(t){t("#heart"+e+".fly"+e).unbind("webkitAnimationIteration animationiteration MSAnimationIteration"),t("#heart"+e).removeAttr("style"),t("#heart"+e).removeClass("fly"+e)}(jQuery)}function setFukidashi(){const e=1,t=2,a=3,n=4;var o=setCss.fukidashi.left,i=setCss.fukidashi.top,r=Number($("#fukidashi").css("width").replace("px","")),c=Number($("#fukidashi").css("height").replace("px","")),s="background-image",p=setCss.fukidashi[s];switch($("#fukidashi").css({top:i,left:o,"background-image":p}),o=setCss.serif.left+20,i=setCss.serif.top+30,r=Number($("#serif").css("width").replace("px","")),c=Number($("#serif").css("height").replace("px","")),$("#serif").css({top:i,left:o}),$("#fukidashi").addClass("fukidashiTail"),cssFukidashiTail={},setCss.fukidashi.tailPos){case e:cssFukidashiTail={"-webkit-transform":"scaleX(-1) scaleY(1)",transform:"scaleX(-1) scaleY(1)"};break;case t:cssFukidashiTail={"-webkit-transform":"scaleX(-1) scaleY(-1)",transform:"scaleX(-1) scaleY(-1)"};break;case a:cssFukidashiTail={"-webkit-transform":"scaleX(1) scaleY(1)",transform:"scaleX(1) scaleY(1)"};break;case n:cssFukidashiTail={"-webkit-transform":"scaleX(1) scaleY(-1)",transform:"scaleX(1) scaleY(-1)"}}$(".fukidashiTail").css(cssFukidashiTail)}function displaySerif(e,t){var a=e;setInnerText(document.getElementById("serif"),a);var n="white",o={shadow0:"black 2px 0px, black 0px 2px, black -2px 0px, black 0px -2px",shadow1:"black 2px -2px, black 2px 2px, black -2px -2px, black -2px 2px",shadow2:"black 1px -2px, black 1px 2px, black -1px -2px, black -1px 2px",shadow3:"black 2px -1px, black 2px 1px, black -2px -1px, black -2px 1px"},i="",r=0;for(var c in o)o[c]=o[c].replace(/black/g,n),i+=o[c],r++,r<Object.keys(o).length&&(i+=", ");$("#serif").css({display:"block",opacity:1,"text-shadow":i}),$("#fukidashi").css({display:"block",opacity:1});var s=t;playVoice(s)}function hideSerif(){$("#serif").css({display:"none",opacity:0}),$("#fukidashi").css({display:"none",opacity:0}),null!=serifTimer&&(serifTimer=null),stopVoice()}function changeNextPage(){isEnd=!0,location.href=g_NextURL}var isDebug=!1,ua=navigator.userAgent,IE=ua.match(/msie/i)||ua.match(/Trident/i),IE6=ua.match(/msie [6.]/i),IE7=ua.match(/msie [7.]/i),IE8=ua.match(/msie [8.]/i),IE9=ua.match(/msie [9.]/i),IE10=ua.match(/msie [10.]/i),IE11=ua.match(/msie [11.]/i),Chrome=ua.match(/chrome/i),Safari=ua.match(/safari/i),fireFox=ua.match(/firefox/i),Opera=ua.match(/opera/i),androidTab=!1,androidSp=ua.match(/Android/i)&&ua.match(/Mobile/i)||ua.match(/Android/i)&&!ua.match(/Mobile/i),iPhone=ua.match(/iPhone/i)||ua.match(/iPad/i)||ua.match(/iPod/i),iPad=!1,g_App=new App,g_SceneGraphRootUI=new Node,g_EntityUI=0,LOOP_OFF=0,LOOP_ON=1,ANIME_OFF=0,ANIME_ON=1,FRAME_START=1,FRAME_END=0,counter=0,flickBeforePos={x:0,y:0},moveTotalLength=0,countA=0,countB=0,countC=0,countD=0,countE=0,countF=0,chapterIndex=0,touchArea=0,isLoadComplete=!1,isStart=!1,isEnd=!1,isOpeningSerifEnd=!1,rnd=0,indexFace=0,defaultFaceNumber=0,faceStartTime=0,faceEndTime=0,onomatopeNum=0,isTapStart=!1,isPress=!1,isMute=!0,isVoicePlay=!1,playingVoiceName="",serifTimer=null,resRatio=1,commonDir=g_RootPath+"anime/common/touch/";setCssImageUrl(),function(e){var t=(e(document),"ontouchend"in document),a=t?"touchstart":"mousedown";androidSp||iPhone||(a="mousedown");if(e("#skipButton").css({display:"none"}),e("#soundToggleButton").css({display:"none"}),e("#skipButton").on(a,function(t){!isEnd&&isLoadComplete&&(isEnd=!0,chapterIndex=999,e("#skipButton").css({display:"none"}),changeNextPage())}),e("#soundToggleButton").on(a,onClickSoundButton),e("#btnSoundOn").on(a,function(t){!isEnd&&isLoadComplete&&(loadSound(),e("#ready").css({display:"none"}),e("#selectButton").css({display:"none"}),isStart=!0,changeSoundStatus("on"),e("#skipButton").css({display:"block"}),e("#soundToggleButton").css({display:"block"}),void 0!=openingText&&displaySerif(openingText,openingVoice))}),e("#btnSoundOff").on(a,function(t){!isEnd&&isLoadComplete&&(loadSound(),e("#ready").css({display:"none"}),e("#selectButton").css({display:"none"}),isStart=!0,changeSoundStatus("off"),e("#skipButton").css({display:"block"}),e("#soundToggleButton").css({display:"block"}),void 0!=openingText&&(displaySerif(openingText,openingVoice),serifTimer=setTimeout(function(){hideSerif(),serifTimer=null,isOpeningSerifEnd=!0},2e3)))}),isSmartphone()){resRatio=2,e("#container").css({top:"107px",left:"-107px","-webkit-transform":"rotate(90deg)",transform:"rotate(90deg)"}),e("#selectButton").css({top:"400px"}),e("#btnSoundOn").css({"background-position":"0px 0px"}),e("#btnSoundOff").css({"background-position":"0px 0px"}),rotateTapAreaAjust();var n=document.getElementsByTagName("body").item(0),o=document.createElement("div");o.id="scrollTarget",n.insertBefore(o,n.firstChild),o.scrollIntoView()}else{e("#container").css({position:"static",padding:"50px 0 0 0",background:"rgba(0,0,0,0)"}),e("#fukidashi").css({"margin-top":"50px","margin-left":"110px"}),e("#serif").css({"margin-top":"50px","margin-left":"110px"}),e("#heart1").css({"margin-top":"50px","margin-left":"110px"}),e("#heart2").css({"margin-top":"50px","margin-left":"110px"}),e("#heart3").css({"margin-top":"50px","margin-left":"110px"}),e("#onomatope1").css({"margin-top":"50px","margin-left":"110px"}),e("#onomatope2").css({"margin-top":"50px","margin-left":"110px"}),e("#onomatope3").css({"margin-top":"50px","margin-left":"110px"}),e("#onomatope4").css({"margin-top":"50px","margin-left":"110px"}),e("#onomatope5").css({"margin-top":"50px","margin-left":"110px"}),e("#onomatope6").css({"margin-top":"50px","margin-left":"110px"}),e("body").css({"background-image":"url("+commonDir+"../adv/ADV_BG_960.jpg?anime="+cacheVersion+")","background-repeat":"no-repeat","background-position":"center top",overflow:"hidden"});var i=commonDir+"../adv/button_reproduce.png?anime="+cacheVersion,r=commonDir+"../adv/button_notReproduce.png?anime="+cacheVersion,c='<style type="text/css">#btnSoundOn:before{display: block; content: "  "; color: rgba(0,0,0,0) !important; width: 276px; height: 56px; background-image: url('+i+"); background-size: 276px; transition: opacity 0.5s ease;}</style>",s='<style type="text/css">#btnSoundOn:hover:before{opacity: 0;}</style>',p='<style type="text/css">#btnSoundOff:before{display: block; content: "  "; color: rgba(0,0,0,0) !important; width: 276px; height: 56px; background-image: url('+r+"); background-size: 276px; transition: opacity 0.5s ease;}</style>",d='<style type="text/css">#btnSoundOff:hover:before{opacity: 0;}</style>';e("head").append(c),e("head").append(s),e("head").append(p),e("head").append(d)}setOnomatope(),setFukidashi(),changeSoundStatus("off")}(jQuery);var SceneResult=function(){this.OnInit=function(){loadCommonImages(),g_expand,g_App.AddSceneGraphRoot(g_SceneGraphRootUI);var e=0,t=0,a=0;for(e=maxAnimeNum-1;e>=0;e--)""===g_strJson[e].address&&g_strJson.splice(e,1);for(e=maxChapterNum-1;e>=0;e--)if(void 0===chapter[e].defaultFace)chapter.splice(e,1);else{for(t=maxCountNum-1;t>=0;t--)chapter[e][aryCount[t]].Threshold<0&&chapter[e][aryCount[t]].Address<0&&delete chapter[e][aryCount[t]];for(t=maxTouchPointNum-1;t>=0;t--)if(t>Object.keys(tapArea).length-1)chapter[e].touchPoint.splice(t,1);else{for(a=maxCountNum-1;a>=0;a--)chapter[e].touchPoint[t][aryCount[a]+"_Add"]<0&&chapter[e].touchPoint[t][aryCount[a]+"_powerRate"]<0&&chapter[e].touchPoint[t][aryCount[a]+"_moveRate"]<0&&(delete chapter[e].touchPoint[t][aryCount[a]+"_Add"],delete chapter[e].touchPoint[t][aryCount[a]+"_powerRate"],delete chapter[e].touchPoint[t][aryCount[a]+"_moveRate"]);for(a=maxVoiceNum-1;a>=0;a--)""===chapter[e].touchPoint[t].playVoice[a]&&chapter[e].touchPoint[t].playVoice.splice(a,1);for(onomatopeNum=maxOnomatopeNum,a=maxOnomatopeNum-1;a>=0;a--)null===chapter[e].touchPoint[t].onomatopeType[a]&&(chapter[e].touchPoint[t].onomatopeType.splice(a,1),onomatopeNum--)}}for(e=0;e<g_strJson.length;e++)if(g_strJson[e].isFace){indexFace=e;break}},this.OnUpdate=function(){function DragStartFunc(e){e.preventDefault()}var Pd=g_App.GetPointingDevice(),i=0,j=0,faceNumber=0;switch(this.m_Sequence){case SCENE1:g_EntityUI=g_App.m_EntityManager.Create(EntityUI),this.ChangeSequence(SCENE2);break;case SCENE2:if(0==this.m_SequenceCnt&&g_EntityUI.Load(),g_EntityUI.IsLoaded()){var element=document.getElementById("MainCanvas");for(element.addEventListener&&element.addEventListener("dragstart",DragStartFunc),i=0;i<g_strJson.length;i++)g_EntityUI.InitAnime(i),0==i?g_EntityUI.PlayAnime(i,chapterIndex+1,chapterIndex+1,LOOP_OFF):i==indexFace&&(eval("defaultFaceNumber = "+chapter[chapterIndex].defaultFace+";"),PlayFaceAnime(defaultFaceNumber,LOOP_OFF,ANIME_OFF));for(j=0;j<chapter[chapterIndex].touchPoint.length;j++)if(chapter[chapterIndex].touchPoint[j].animationType>0){var animeIndex=chapter[chapterIndex].touchPoint[j].animationType-1;animeIndex!=indexFace&&g_EntityUI.PlayAnime(chapter[chapterIndex].touchPoint[j].animationType-1,FRAME_START,FRAME_START,LOOP_OFF)}isLoadComplete=!0,this.ChangeSequence(SCENE3)}break;case SCENE3:var px=Pd.GetX(),py=Pd.GetY();heartX=px*resRatio*pageZoom,heartY=py*resRatio*pageZoom;var touchIndex=0,touchPointData;if(Pd.IsTrigger()&&!isEnd&&isTapArea(px*resRatio/pageZoom,py*resRatio/pageZoom)>0){isOpeningSerifEnd||null==serifTimer||(hideSerif(),serifTimer=null,isOpeningSerifEnd=!0),touchArea=isTapArea(px*resRatio/pageZoom,py*resRatio/pageZoom),touchIndex=touchArea-1,touchPointData=chapter[chapterIndex].touchPoint[touchIndex],isTapStart=!0;var aryPlayVoice=chapter[chapterIndex].touchPoint[touchIndex].playVoice,voiceNum=aryPlayVoice.length;if(voiceNum>0){var rndVoice=Math.floor(Math.random()*voiceNum);playVoice(aryPlayVoice[rndVoice])}for(i=0;i<aryCount.length;i++)void 0!==chapter[chapterIndex].touchPoint[touchIndex][aryCount[i]+"_Add"]&&eval(aryCount[i]+" += chapter[chapterIndex].touchPoint[touchIndex][aryCount[i] + '_Add'];")}if(Pd.IsPress()&&!isEnd&&isTapArea(px*resRatio/pageZoom,py*resRatio/pageZoom)>0){var isChangeTapArea=!1;isTapStart&&(isChangeTapArea=!0,isTapStart=!1),isPress=!0;var isCountUp=!1;touchArea!=isTapArea(px*resRatio/pageZoom,py*resRatio/pageZoom)&&(touchArea=isTapArea(px*resRatio/pageZoom,py*resRatio/pageZoom),isChangeTapArea=!0),touchIndex=touchArea-1,touchPointData=chapter[chapterIndex].touchPoint[touchIndex],isChangeTapArea&&(setOnomatope(),rnd=Math.floor(Math.random()*touchPointData.faceChangePattern)),eval("var touchPointFace = "+touchPointData.face+";");var isDisplayHeart=!1;for(i=0;i<aryCount.length;i++)if(void 0!==touchPointData[aryCount[i]+"_Add"]&&0!==touchPointData[aryCount[i]+"_Add"]){isDisplayHeart=!0;break}isDisplayHeart?null==heartTimer&&(playHeart(),heartTimer=setInterval(function(){playHeart()},2e3)):(clearInterval(heartTimer),heartTimer=null);var onomatopeData=touchPointData.onomatopeType;for(i=0;i<onomatopeData.length;i++)onomatopeData[i]?playOnomatope(i,i):stopOnomatope(i);if(touchPointData.animationType>1){var moveAnimeIndex=touchPointData.animationType-1;if(indexFace!=moveAnimeIndex)for(i=1;i<g_strJson.length;i++)i!=indexFace&&i!=moveAnimeIndex&&g_EntityUI.StopAnime(i);else for(i=0;i<chapter[chapterIndex].touchPoint.length;i++)chapter[chapterIndex].touchPoint[i].animationType>0&&chapter[chapterIndex].touchPoint[i].animationType-1!=indexFace&&g_EntityUI.PlayAnime(chapter[chapterIndex].touchPoint[i].animationType-1,FRAME_START,FRAME_START,LOOP_OFF);(g_EntityUI.IsPlayEnd(moveAnimeIndex)&&moveAnimeIndex!=indexFace||isChangeTapArea)&&g_EntityUI.PlayAnime(moveAnimeIndex,FRAME_START,FRAME_END,LOOP_OFF),(g_EntityUI.IsPlayEnd(indexFace)||isChangeTapArea)&&PlayFaceAnime(touchPointFace,LOOP_OFF,ANIME_ON,rnd)}else{for(i=0;i<chapter[chapterIndex].touchPoint.length;i++)chapter[chapterIndex].touchPoint[i].animationType>0&&chapter[chapterIndex].touchPoint[i].animationType-1!=indexFace&&g_EntityUI.PlayAnime(chapter[chapterIndex].touchPoint[i].animationType-1,FRAME_START,FRAME_START,LOOP_OFF);(g_EntityUI.IsPlayEnd(indexFace)||isChangeTapArea)&&PlayFaceAnime(touchPointFace,LOOP_OFF,ANIME_ON,rnd)}isSmartphone()||!function(e){e("#hand").css({"margin-top":py-45+50,"margin-left":px-15+55,display:"block"}),e("body").addClass("noCursor")}(jQuery),0===counter&&(flickBeforePos={x:px,y:py},moveTotalLength=0);var moveX=Math.abs(px-flickBeforePos.x),moveY=Math.abs(py-flickBeforePos.y);for(moveTotalLength+=Math.sqrt(Math.pow(moveX,2)+Math.pow(moveY,2)),counter++,counter>=5&&(isCountUp=!0,counter=0),i=0;i<aryCount.length;i++)if(void 0!==chapter[chapterIndex].touchPoint[touchIndex][aryCount[i]+"_Add"]&&0!==chapter[chapterIndex].touchPoint[touchIndex][aryCount[i]+"_Add"]&&moveTotalLength>0){var baseAddPoint=chapter[chapterIndex].touchPoint[touchIndex][aryCount[i]+"_Add"],powerRate=chapter[chapterIndex].touchPoint[touchIndex][aryCount[i]+"_powerRate"],moveRate=chapter[chapterIndex].touchPoint[touchIndex][aryCount[i]+"_moveRate"],addPoint=baseAddPoint+Math.pow(moveTotalLength*moveRate,powerRate);eval(aryCount[i]+" += addPoint;")}for(i=0;i<aryCount.length&&void 0!==chapter[chapterIndex][aryCount[i]];i++)if(!(chapter[chapterIndex][aryCount[i]].Threshold<1)&&(eval("var countTmp = "+aryCount[i]+";"),countTmp>chapter[chapterIndex][aryCount[i]].Threshold)){if(chapter[chapterIndex][aryCount[i]].Address>=100){for(isEnd=!0,displaySerif(chapter[chapterIndex][aryCount[i]].EndText,chapter[chapterIndex][aryCount[i]].EndVoice),i=0;i<onomatopeNum;i++)stopOnomatope(i);isSmartphone()||!function(e){e("body").removeClass("noCursor"),e("#hand").css({display:"none"})}(jQuery),clearInterval(heartTimer),heartTimer=null,this.ChangeSequence(SCENE4)}else{for(chapterIndex=chapter[chapterIndex][aryCount[i]].Address-1,g_EntityUI.PlayAnime(0,chapterIndex+1,chapterIndex+1,LOOP_OFF),eval("defaultFaceNumber = "+chapter[chapterIndex].defaultFace+";"),j=0;j<g_strJson.length;j++)0!=j&&j!=indexFace&&g_EntityUI.StopAnime(j);if(Pd.IsPress())for(touchArea=isTapArea(px*resRatio/pageZoom,py*resRatio/pageZoom),touchIndex=touchArea-1,touchPointData=chapter[chapterIndex].touchPoint[touchIndex],rnd=Math.floor(Math.random()*touchPointData.faceChangePattern),eval("var touchPointFace = "+touchPointData.face+";"),PlayFaceAnime(touchPointFace,LOOP_ON,ANIME_ON,rnd),j=0;j<chapter[chapterIndex].touchPoint.length;j++)chapter[chapterIndex].touchPoint[j].animationType>0&&chapter[chapterIndex].touchPoint[j].animationType-1!=indexFace&&g_EntityUI.PlayAnime(chapter[chapterIndex].touchPoint[j].animationType-1,FRAME_START,FRAME_END,LOOP_OFF);else for(PlayFaceAnime(defaultFaceNumber,LOOP_OFF,ANIME_OFF),j=0;j<chapter[chapterIndex].touchPoint.length;j++)chapter[chapterIndex].touchPoint[j].animationType>0&&g_EntityUI.PlayAnime(chapter[chapterIndex].touchPoint[j].animationType-1,FRAME_START,FRAME_START,LOOP_OFF);for(j=0;j<aryCount.length&&void 0!==chapter[chapterIndex][aryCount[j]];j++)eval(aryCount[j]+" = 0;")}break}}else if(Pd.IsPress()&&!isEnd&&0==isTapArea(px*resRatio/pageZoom,py*resRatio/pageZoom)){if(touchArea=0,!isPress&&g_EntityUI.IsAnimePlayFinished())return;if(isSmartphone()||!function(e){e("body").removeClass("noCursor"),e("#hand").css({display:"none"})}(jQuery),clearInterval(heartTimer),heartTimer=null,g_EntityUI.IsAnimePlayFinished())for(isPress=!1,g_EntityUI.StopAnimeAll(),eval("defaultFaceNumber = "+chapter[chapterIndex].defaultFace+";"),PlayFaceAnime(defaultFaceNumber,LOOP_OFF,ANIME_OFF),i=0;i<onomatopeNum;i++)stopOnomatope(i)}if(!Pd.IsPress()){if(touchArea=0,!isPress&&g_EntityUI.IsAnimePlayFinished())return;if(isSmartphone()||!function(e){e("body").removeClass("noCursor"),e("#hand").css({display:"none"})}(jQuery),clearInterval(heartTimer),heartTimer=null,g_EntityUI.IsAnimePlayFinished()&&(isPress=!1,!isEnd)){for(g_EntityUI.StopAnimeAll(),eval("defaultFaceNumber = "+chapter[chapterIndex].defaultFace+";"),PlayFaceAnime(defaultFaceNumber,LOOP_OFF,ANIME_OFF),i=0;i<onomatopeNum;i++)stopOnomatope(i);counter=0,moveTotalLength=0,flickBeforePos={x:0,y:0}}}break;case SCENE4:isPress&&g_EntityUI.IsAnimePlayFinished()&&(isPress=!1,g_EntityUI.StopAnimeAll(),chapterIndex=999,null==serifTimer&&isMute&&(serifTimer=setTimeout(function(){changeNextPage()},2e3)))}}};SceneResult.prototype=new Scene;var EntityUI=function(){var e=!1,t=0,a=[];for(t=0;t<g_strJson.length;t++)a[t]={},a[t].Priority=t,a[t].X=0,a[t].Y=0,a[t].SetTime=1,a[t].Speed=1,a[t].Loop=0,a[t].ScaleX=1,a[t].ScaleY=1,a[t].AnimeData=new AnimeData(g_RootPath+"drama/card/touch/"+g_strJson[t].address,g_strTexturePath,e),a[t].AnimeObj=new AnimeObj;for(var n=0;n<a.length;n++)g_SceneGraphRootUI.AddChild(a[n].AnimeObj);this.Load=function(){for(var e=0;e<a.length;e++)a[e].AnimeData.Load()},this.IsLoaded=function(){for(var e=0;e<a.length;e++)if(0==a[e].AnimeData.IsLoaded())return!1;return!0},this.OnUpdate=function(){},this.setAnime=function(e,t,n,o,i,r,c,s,p,d,u){e.SetAnimeData(t),e.SetPriority(n),e.SetPos(o,i),r>0?e.SetTime(r):e.SetTime(1),e.SetScale(p,d),e.SetPlaySpeed(c),0!=s&&(r>0?e.SetLoop(r,e.GetEndTime()):e.SetLoop(1,e.GetEndTime())),null!==u&&void 0!==u&&(a[u].endTime=e.GetEndTime()),e.Stop()},this.InitAnime=function(e){this.setAnime(a[e].AnimeObj,a[e].AnimeData,a[e].Priority,a[e].X,a[e].Y,a[e].SetTime,a[e].Speed,a[e].Loop,a[e].ScaleX,a[e].ScaleY,e)},this.PlayAnime=function(e,t,n,o,i){var r=1;t>0&&(r=t),a[e].AnimeObj.SetBeginTime(r),o>0?n>=r?a[e].AnimeObj.SetLoop(r,n):a[e].AnimeObj.SetLoop(r,a[e].endTime):(n>=r?a[e].AnimeObj.SetEndTime(n):a[e].AnimeObj.SetEndTime(a[e].endTime),void 0!=i&&i>0?a[e].AnimeObj.SetEndHide():a[e].AnimeObj.SetEndPause()),a[e].AnimeObj.SetPlaySpeed(a[e].Speed),a[e].AnimeObj.Play(r)},this.SeekAnime=function(e,t){a[e].AnimeObj.Play(t)},this.StopAnime=function(e){a[e].AnimeObj.Stop()},this.PauseAnime=function(e,t){t<1?(a[e].AnimeObj.SetPlaySpeed(1),a[e].AnimeObj.Play()):a[e].AnimeObj.Pause()},this.IsPlayEnd=function(e){return a[e].AnimeObj.IsPlayFinished()},this.GetPlayTime=function(e){return a[e].AnimeObj.GetTime()},this.GetEndFrameTime=function(e){return a[e].endTime},this.GetEndMode=function(e){return a[e].AnimeObj.m_EndMode},this.PutAnimeObj=function(e,t,n){a[e].AnimeObj.AddChild(a[t].AnimeObj,n)},this.PutAnimeObjPriority=function(e,t,n){a[e].AnimeObj.AddChildPriority(a[t].AnimeObj,n)},this.PutTextObj=function(e,t,n){a[e].AnimeObj.AddChild(t,n)},this.DisplayText=function(e,t,a,n,o,i,r,c,s){e.SetPriority(s),e.SetPos(a,n),e.SetFontSize(o),e.SetOriginType(i,r),e.SetFontColor(c),e.SetString(t)},this.StopAnimeAll=function(){for(var e=1;e<a.length;e++)if(e==indexFace){var t=20*(defaultFaceNumber-1)+1;g_EntityUI.PlayAnime(e,t,t,LOOP_OFF)}for(e=0;e<chapter[chapterIndex].touchPoint.length;e++)chapter[chapterIndex].touchPoint[e].animationType>0&&g_EntityUI.PlayAnime(chapter[chapterIndex].touchPoint[e].animationType-1,FRAME_START,FRAME_START,LOOP_OFF)},this.IsAnimePlayFinished=function(){for(var e=!0,t=1;t<a.length;t++)if(!this.IsPlayEnd(t)){e=!1;break}return e}};EntityUI.prototype=new EntityUI;var onomatopePos,onomatopeDelay={onomatope1:0,onomatope2:0,onomatope3:0,onomatope4:0,onomatope5:0,onomatope6:0},heartTimer=null,heartX=0,heartY=0;